<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.58.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>PermissionsDispatcher 4.x: A bunch of stuff&nbsp;&ndash;&nbsp;hotchemi.github.io</title><link rel=stylesheet href=/css/core.min.9141674b541ac34c12766aa91f496926d180a9d96061141f99b38b5ffd0d3f6dd7a8e493741b8c4ab6d7774cee185e51.css integrity=sha384-kUFnS1Qaw0wSdmqpH0lpJtGAqdlgYRQfmbOLX/0NP23XqOSTdBuMSrbXd0zuGF5R><meta name=twitter:card content=summary><meta name=twitter:title content="PermissionsDispatcher 4.x: A bunch of stuff"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">hotchemi.github.io</span></a></span>
<span class="header right-side"></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">PermissionsDispatcher 4.x: A bunch of stuff</h1><p class="article date">2018-12-25</p></section><article class="article markdown-body"><p>From July of this year we’ve been adding/removing a bunch of stuff to/from PermissionsDispatcher 4.x(the latest is 4.2.0 for now). I’m personally honored that there’re no changes which break backward API compatibility at all, but some of the changes are not trivial and supposed to be recognized to let you build a reliable and substantial runtime permissions grant flow in your application. In this article I’ll go through some significant changelog topics respectively in minutes.</p><h3 id=androidx-support>AndroidX support</h3><p><em>PR: <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/pull/494>https://github.com/permissions-dispatcher/PermissionsDispatcher/pull/494</a></em></p><p>Most importantly we’ve started off supporting AndroidX in favor of Android <a href=https://developer.android.com/jetpack/>Jetpack</a> components advent. Hence to upgrade PermissionsDispatcher to 4.x from previous versions you have to complete AndroidX migration in your application beforehand.</p><h3 id=drop-android-app-fragment-support>Drop android.app.Fragment support</h3><p><em>PR: <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/pull/498>https://github.com/permissions-dispatcher/PermissionsDispatcher/pull/498</a></em></p><p>Related to the AndroidX support mentioned above we simultaneously dropped android.app.Fragment support as it has been deprecated.</p><h3 id=drop-xiaomi-support>Drop Xiaomi support</h3><p><em>Issue: <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/544>https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/544</a></em></p><p>Xiaomi is the thing that we’ve been seriously struggling with for years. Originally we decided to add a dedicated workaround for Xiaomi since they customized Android framework permission mechanism and the presented code on <a href=https://developer.android.com/training/permissions/requesting>Android Developers</a> didn’t work well as expected. But <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/533>reportedly</a> recent Miui(OS on Xiaomi) has revised their customization and we don’t need to puzzle over it anymore! We strongly believe that our decision is for the right direction but also recommend you to test your app behavior on several physical Xiaomi devices if a percentage of the device is unignorable. Note that this change is from <strong>4.1.0</strong>.</p><h3 id=incremental-annotation-processing>Incremental annotation processing</h3><p><em>Issue: <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/473>https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/473</a></em></p><p>Gradle 4.7 introduced incremental annotation processing and seemingly some popular libraries have started supporting the feature like Dagger2 has done. Likewise PermissionsDispatcher supports the incremental processing to make build time faster from <strong>4.2.0</strong>! Although be sure to note that the feature is <strong>only for Java</strong> because kapt hasn’t supported incremental annotation processors yet. For more detail check YouTrack link below.</p><p><a href=https://youtrack.jetbrains.com/issue/KT-23880>*https://youtrack.jetbrains.com/issue/KT-23880</a>*</p><h3 id=flexible-onshowrationale-handling>Flexible OnShowRationale handling</h3><p><em>Issue: <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/434>https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/434</a></em></p><p>We’ve got a feedback that current OnShowRationale annotated method signature is sort of hard to handle especially with DialogFragment since parameter’s type PermissionRequest is not serializable. After a few discussions we decided to change API as below(don’t worry we keep a backward compatibility) from <strong>4.2.0</strong>.</p><ul><li><p>Make PermissionRequest parameter optional</p></li><li><p>When OnShowRationale annotated method has no parameter processor will generate process${NeedsPermissionMethodName}PermissionRequest and cancel${NeedsPermissionMethodName}PermissionRequest at compile time</p></li></ul><p>Consequently if you want to show DialogFragment in OnShowRationale annotated method, it can be done easily! Here’s a minimum example.</p><pre><code>@RuntimePermissions
class MainActivity : AppCompatActivity() {
    @NeedsPermission(Manifest.permission.CAMERA)
    fun showCamera() {
    }

    @OnShowRationale(Manifest.permission.CAMERA)
    fun showRationaleForCamera() {
      PermissionDialogFragment().show()
    }
}
</code></pre><p>Then processor will generate processShowCameraPermissionRequest and cancelShowCameraPermissionRequest as extension methods. Utilize them as appropriate in DialogFragment.</p><pre><code>class PermissionDialogFragment : DialogFragment() {
  private lateinit var activity: MainActivity

  override fun onAttach(activity: Activity) {
    super.onAttach(activity)
    if (activity is MainActivity) {
      this.activity = activity
    }
  }

  override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {
    return AlertDialog.Builder(activity)
             .setPositiveButton(&quot;OK&quot;) {_, _ -&gt;
               activity.processShowCameraPermissionRequest()
             }
             .setNegativeButton(&quot;NO&quot;) {_, _ -&gt;
               activity.cancelShowCameraPermissionRequest()
             }
             .create()
  }
}
</code></pre><h3 id=new-maven-groupid>New maven groupId</h3><p><em>Issue: <a href=https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/560>https://github.com/permissions-dispatcher/PermissionsDispatcher/issues/560</a></em></p><p>Lastly, library’s artifacts groupId has been changed from com.github.hotchemi to org.permissionsdispatcher from <strong>4.2.0</strong>. The reason of the change is we’ve had issues in the past that people accidentally pulled in from Jitpack, not JCenter that we provide our artifacts to. The problem behind it is Jitpack will pick up on any group ID starting with com.github. This would mean PermissionsDispatcher users need to specify jcenter() first, which contains a potential risk to encounter <a href=https://blog.autsoft.hu/a-confusing-dependency/>malicious dependencies</a> incident. This change is merely cumbersome for existing users but we’re recognizing that preventing any security risks is the best thing to be prioritized.</p><h3 id=others>Others</h3><ul><li><p>We prepared a cozy document website upon GitBook! <a href=https://permissions-dispatcher.github.io/>https://permissions-dispatcher.github.io</a></p></li><li><p>Several <a href=https://permissions-dispatcher.github.io/CHANGELOG.html>bug fixes</a> are included as usual.</p></li></ul><p>It’s actually kind of incredible that we’ve been maintaining PermissionsDispatcher over 3 years and it’s used in plenty of applications across the world! I can assure we’re going to continuously push so hard to make the library better and provide pleasant developer experience to users from now on.</p></article><section class="article labels"><a class=tag href=/tags/android/>android</a><a class=tag href=/tags/oss/>oss</a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/post/2020_and_end_of_the_podcast/><span class="li iconfont icon-article"></span>2020年の始まりとpodcastの終りについて</a></p><p><a class=link href=/post/polite-way-to-open-a-bug-report/><span class="li iconfont icon-article"></span>A polite way to open a bug report</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>Copyright (c) 2020, Shintaro Katafuchi; all rights reserved.</p></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/&#43;DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l&#43;B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd&#43;qj&#43;o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><script src=/js/prism.min.28f2bfd6dfaa7ad0e8b973373bb7db234d27a2faafc26d5ffd2de4c2b1b5f2bf80011f2e2976dc9fb364abb13f63ebdc.js integrity=sha384-KPK/1t&#43;qetDouXM3O7fbI00novqvwm1f/S3kwrG18r&#43;AAR8uKXbcn7Nkq7E/Y&#43;vc></script></body></html>